<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Spy Unit Tests</title>
  <link rel="import" href="../main.html">
  <script src="../node_modules/chai/chai.js"></script>
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
  <script>
    'use strict';

    var Spies = System.get('src/spies.es6').default;
    var expect = chai.expect;

    describe('Spy', function() {
      describe('#spy', function() {
        describe('on function', function() {
          var C = {};

          beforeEach(function(done) {
            C.fn = function() { return 1; };
            done();
          });


          it('should verify single call on function with no arguments', function() {
            Spies.spy(C, 'fn');

            expect(C.fn()).to.equal(1);
            Spies.verify(C.fn)().called();
            Spies.verify(C.fn)(2).called.times(0);
          });  


          it('should reset when calling reset', function() {
            Spies.spy(C, 'fn');
            C.fn();

            Spies.reset(C.fn);
            Spies.spy(C, 'fn');
            Spies.verify(C.fn)().called.times(0);
          });
        });

        describe('on class', function() {
          var C = function() {};
          C.prototype.fn1 = function() { return 1; };
          C.prototype.fn2 = function() { return 2; };

          it('should spy on all functions in a class', function() {
            var c = new C();
            Spies.spy(c);

            expect(c.fn1()).to.equal(1);
            expect(c.fn2()).to.equal(2);
            Spies.verify(c.fn1)().called();
            Spies.verify(c.fn2)().called();
          });

          it('should reset when calling reset', function() {
            var c = new C();
            Spies.spy(c);

            c.fn1();
            c.fn2();
            Spies.reset(c);
            Spies.spy(c);
            Spies.verify(c.fn1)().called.times(0);
            Spies.verify(c.fn2)().called.times(0);
          });
        });
      });
    });
  </script>
</body>
</html>