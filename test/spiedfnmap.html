<!DOCTYPE html>
<html>
<head>
  <title>SpiedFnMap Unit Tests</title>
  <link rel="import" href="../main_test.html">
</head>
<body>
  <script>
    'use strict';

    var SpiedFnMap = System.get('src/spiedfnmap.es6').default;
    var expect = chai.expect;

    describe('SpiedFnMap', function() {
      var map;

      var fnName = 'fnName';
      var Scope = function() {};
      Scope[fnName] = function() {};

      beforeEach(function(done) {
        map = new SpiedFnMap();
        done();
      })

      describe('#get', function() {
        beforeEach(function(done) {
          map.put(Scope, fnName);
          done();
        });

        it('should return the stored function', function() {
          expect(map.get(Scope, fnName)).not.to.be.null;
        });

        it('should return null if there is no stored scope', function() {
          expect(map.get({a:1}, fnName)).to.be.null;
        });

        it('should return null if there is no stored name', function() {
          expect(map.get(Scope, 'otherName')).to.be.null;
        });
      });

      describe('#put', function() {
        it('should work with new scope', function() {
          var spiedFn = map.put(Scope, fnName);
          expect(map.get(Scope, fnName)).to.be.equal(spiedFn);
        });

        it('should work with existing scope', function() {
          map.put(Scope, fnName);
          var fnName2 = 'function2';
          var spiedFn = map.put(Scope, fnName2);
          expect(map.get(Scope, fnName2)).to.be.equal(spiedFn);
        });
      });

      describe('#restore', function() {
        beforeEach(function(done) {
          map.put(Scope, fnName);
          done();
        });

        it('should restore and delete the spied function', function() {
          var origFn = Scope[fnName];
          Scope[fnName] = function() { 'otherFunction'; };

          map.restore(Scope, fnName);
          expect(Scope.fnName).to.be.equal(origFn);
          expect(map.get(Scope, fnName)).to.be.null;
        });

        it('should not throw error when handling unknown function', function() {
          map.restore(Scope, 'nonexistent function');
        });
      });
    });
  </script>
</body>
</html>